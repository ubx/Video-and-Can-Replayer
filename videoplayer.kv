#:import win kivy.core.window

<Marker@MapMarker>:

<MapWidget@Scatter>:
    size_hint: None,None
#    #  for debugging:
#    canvas.before:
#        Color:
#            rgba: 1, 1, 1, 1
#        Rectangle:
#            pos: self.pos
#            size: self.size


<MainWindow>:
    BoxLayout:
        orientation: 'vertical'
        AnchorLayout:
            anchor_x: 'right'
            anchor_y: 'bottom'

            VideoPlayer:
                id: video_player
                size_hint: 1.0,1.0

                source: app.get_file()
                allow_stretch: True
                state: 'stop'
                on_state:
                    app.on_state(args[1])
                on_position:
                    app.on_position(args[1], video_player)
                    progress_bar.value=args[1]
                on_touch_down:
                    self.state = 'pause'
                on_touch_move:
                    self.state = 'pause'
                on_touch_up:
                    self.state = 'pause'


            MapWidget:
                id: mapwidget
                AnchorLayout
                    anchor_x: 'center'
                    anchor_y: 'center'
                    id: map
                AnchorLayout
                    anchor_x: 'center'
                    anchor_y: 'center'
                    Marker:
                        id: marker



        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: '48dp'

            Button:
                text: 'Next'
                on_press:
                    app.btn_next(video_player)

            Button:
                text: 'Previous'
                on_press:
                    app.btn_previous(video_player)

            Button:
                text: 'Bookmark'
                on_press:
                    app.btn_bookmark(video_player)

            Button:
                text: 'Syncpoint'
                on_press:
                    app.btn_syncpoint(video_player)
            Button:
                text: 'Exit'
                on_press:
                    app.stop()


        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: '48dp'

            Label:
                text:
                    app.realtime(progress_bar.value)

            ProgressBar:
                id: progress_bar
                min: 0
                max: video_player.duration
                step: 1
                on_width:
                    app.on_width()


        BoxLayout:
            id: bookmarks
            orientation: 'vertical'
            size_hint: None, None
            height: '64'

#        BoxLayout:
#            orientation: 'horizontal'
#            size_hint_y: None
#            size_hint_x: 0.3
#            height: '24'
#
#            Label:
#                text: 'UTC'
#            Label:
#                text: '12:33'
#            Label:
#                text: 'Pos'
#            Label:
#                text: '7.0 / 47.0'


<ModalDialog>:
    size_hint: None, None
    size: 400, 180

    BoxLayout:
        orientation: 'vertical'
        Label:
            text: "Enter utc time"
        Label:
            id: label
        TextInput:
            multiline: False
            hint_text:'Enter time'
            on_text:
                root.ts=root.checkTime(args[1])
                label.text= 'YYYY-MM-DD HH:MM:SS' if root.ts is None else args[1]
                btn_bookmark.disabled=root.ts is None

        BoxLayout:
            orientation: 'horizontal'
            Button:
                id: btn_bookmark
                text: "OK"
                disabled: True
                on_release:
                    root.set_syncpoint()
                    root.dismiss()
            Button:
                text: "Cancel"
                on_release:
                    root.dismiss()
